<!DOCTYPE html>
<html lang="en">
	<head>
	<title>Demo | Input Text</title>
	<meta charset="utf-8">
	<link rel="icon" href="http://dzyngiri.com/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="http://dzyngiri.com/favicon.png" type="image/x-icon" />
    <meta name="description" content="Codester is a free responsive Bootstrap template by Dzyngiri">
    <meta name="keywords" content="free, template, bootstrap, responsive">
    <meta name="author" content="Inbetwin Networks">  
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" media="screen">
	<link rel="stylesheet" href="css/responsive.css" type="text/css" media="screen">
	<link rel="stylesheet" href="css/style.css" type="text/css" media="screen">
	<link rel="stylesheet" href="css/touchTouch.css" type="text/css" media="screen">
	<link rel="stylesheet" href="css/kwicks-slider.css" type="text/css" media="screen">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/superfish.js"></script>
	<script type="text/javascript" src="js/jquery.flexslider-min.js"></script>
	<script type="text/javascript" src="js/jquery.kwicks-1.5.1.js"></script>
	<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>    
	<script type="text/javascript" src="js/touchTouch.jquery.js"></script>
	<script type="text/javascript">if($(window).width()>1024){document.write("<"+"script src='js/jquery.preloader.js'></"+"script>");}	</script>

	<script>		
		 jQuery(window).load(function() {	
		 $x = $(window).width();		
	if($x > 1024)
	{			
	jQuery("#content .row").preloader();    }	
		 
     jQuery('.magnifier').touchTouch();			
    jQuery('.spinner').animate({'opacity':0},1000,'easeOutCubic',function (){jQuery(this).css('display','none')});	
  		  }); 
				
	</script>

	<script src="js/common.js"></script>
	<script src="js/async.js"></script>
	<script src="js/template_mgr.js"></script>
	<script src="js/image_ugc.js"></script>
	<script src="js/template.js"></script>
	<script src="js/ugc_utility.js"></script>
	<script src="js/dooh_info.js"></script>
	<script src="js/dooh_preview.js"></script>
	
	<script>
	$( document ).ready(function() {
		if(localStorage.template_userText){
			var text = localStorage.template_userText.replace("_",/\n/g);
			$("#inputText").val(text);
		}
	});
		function init(){
			var btnChoosePic = $("#chossePic");
			var btnWowPicText = $("#wow_pic_text");
			var btnUpload = $("#upload");
			var btnSend = $('#btnSend');
			
			localStorage.selectedTemplate = "wow_pic_text";
			localStorage.selectedSubTemplate = "picture_plus_text";
			
			btnChoosePic.click(function(){
				btnWowPicText.click();
			});
			
			
			$("#inputText").focus(function(){
				if(localStorage.template_userText){
					var text = localStorage.template_userText.replace("_",/\n/g);
					$("#inputText").val(text);
				}else{
					$("#inputText").val('');
				}
			});
			btnSend.click(function(){
				if(btnWowPicText.val() == ""){
					alert("您忘記選擇圖片！");
				}else{
					var inputContent = $("#inputText").val().replace(/\n/g,"_");
					console.log(inputContent);
				
					async.series([
				              function(callback){
				            	  insertSpace(inputContent, function(res){
				            		  console.log(res);
				            		  inputContent = res;
				            		  localStorage.template_userText = res;
				            		  callback(null, 'one');
				            	  
				            	  });
				                  
				              },
				              function(callback){
				                  callback(null, 'two');
				              }
				          ],
				          function(err, results){
							if(!err){
					    		var ugcProjectId = localStorage.selectedTemplate +'-'+ localStorage._id +'-'+ (new Date()).toISOString().replace(/[-:.]/g, "");
								var form = $("#imgform");
								localStorage.projectId = ugcProjectId;
								$("#ugcId").attr("value", ugcProjectId);
								$("#userId").attr("value", localStorage._id);
								$("#fbId").attr("value", localStorage.fbId);
								$("#contentGenre").attr("value", localStorage.selectedTemplate);
								$("#text").attr("value", inputContent);
								action = "/miix/ugcInfo/"; 
						
								form.attr("action", action);
								btnUpload.click();
							}

							
				          });

				}
			});
			
		}
		function check(words){
			if(words.length > 8)
				return false;
			else
				return true;
		}
		
		var insertSpace = function(sourceText, cb_insertSpace){ 
		    console.log(sourceText);
		    
		    String.prototype.splice = function( idx, rem, s ) {
		        return (this.slice(0,idx) + s + this.slice(idx + Math.abs(rem)));
		    };
		    
		    var getIndexNext = [];
		    var getIndexPrevious = [];
		    var regExp_English = /^[a-zA-Z]+$/;
		    var regExp_Chinese = /[^\x00-\xff]/;
		    var offSetNext = 0;
		    var offSetPrevious = 0;
		    
		    for(var i = 0; i<sourceText.length; i++) {
		        if(regExp_Chinese.test(sourceText[i]) && sourceText[i] != '_' && i != sourceText.length-1) {
		            if(regExp_English.test(sourceText[i+1])) {
		                getIndexNext.push(i);
		            }
		        }
		    }
		    
		    for(var i = 0; i<getIndexNext.length; i++) {
		    	sourceText = sourceText.splice(getIndexNext[i]+1+offSetNext, 0, " ");
		        offSetNext++;
		    }
		    
		    for(var i = 0; i<sourceText.length; i++) {
		        if(regExp_Chinese.test(sourceText[i]) && sourceText[i] != '_' && i != 0) {
		            if(regExp_English.test(sourceText[i-1])) {
		                getIndexPrevious.push(i);
		            }
		        }
		    }
		    
		    for(var i = 0; i<getIndexPrevious.length; i++) {
		    	sourceText = sourceText.splice(getIndexPrevious[i]+offSetPrevious, 0, " ");
		        offSetPrevious++;
		    }
		    
		    console.log(sourceText);
		    cb_insertSpace(sourceText);
		    
		}
		
	</script>
	<!--[if lt IE 8]>
  		<div style='text-align:center'><a href="http://www.microsoft.com/windows/internet-explorer/default.aspx?ocid=ie6_countdown_bannercode"><img src="http://www.theie6countdown.com/img/upgrade.jpg"border="0"alt=""/></a></div>  
 	<![endif]-->
	<!--[if (gt IE 9)|!(IE)]><!-->
	<!--<![endif]-->
	<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <link rel="stylesheet" href="css/docs.css" type="text/css" media="screen">
    <link rel="stylesheet" href="css/ie.css" type="text/css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
  <![endif]-->
  
  <!--Google analytics code	  
	  <script type="text/javascript">
           var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-29231762-1']);
          _gaq.push(['_setDomainName', 'dzyngiri.com']);
          _gaq.push(['_trackPageview']);
        
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
      </script>
      -->
</head>

	<body onload="init();">
     <div class="spinner"></div> 
<!-- header start -->
<header>
      <div class="container clearfix">
    <div class="row">
          <div class="span12">
        <div class="navbar navbar_">
              <div class="container">
            <h1 class="brand brand_"><a href="index.html"><img alt="" src="img/logo.png"> </a></h1>

            <div class="nav-collapse nav-collapse_  collapse"></div>
          </div>
            </div>
      </div>
        </div>
  </div>
    </header>
<div class="bg-content">
      <div class="container">
    <div class="row"></div>
      <div class="row">
          <div class="span12"> 
          <h3>版型二</h3>
        <!-- slider -->
        <div class="slide">
        <img src="img/t2.jpg">
        </div>
        
        <span id="responsiveFlag"></span>
        <div class="block-slogan">
        	<p style="text-align:left; padding-top:20px;">
            	<button id="chossePic" class="btn btn-1">選擇圖片</button>
           	</p>
           	<div style="height:0px;overflow:hidden"> 
				<form id="imgform" method="post" action="#" enctype="multipart/form-data">  
					<!--	<form name="uploadFiles" id="imgform" method="post" action="/miix/video/user_content_files"> -->
					<input name="file" id="wow_pic_text" type="file" accept="image/*" />
					<input name="projectId" id="ugcId" type="hidden"/>
					<input name="_id" id="userId" type="hidden" />
					<input name="fbUserId" id="fbId" type="hidden" />
					<input name="genre" id="contentGenre" type="hidden" />
					<input name="text" id="text" type="hidden" />
					<input name="filesSubmit" id="upload" type="submit" />
				</form>
			</div>
		</div>
          <form id="form-search" action="search.php" method="GET" accept-charset="utf-8" >
           	  <div class="clearfix">
                <textarea id="inputText" rows="3" onFocus="if(this.value =='' ) this.value=''" onBlur="if(this.value=='') this.value=''">請分三行，輸入24個文字</textarea>
           	  </div>
            </form>
            <div class="block-slogan">
			<p style="text-align:left; padding-top:20px;">
            		<button id="btnSend" class="btn btn-1">送出</button>
            	</p>
          </div>
            </div>
        
      </div>
        </div>
  </div>
      
      <!-- content -->
      
      <div id="content" class="content-extra"><div class="ic"></div>


  </div>
    </div>

<!-- footer -->
<footer>
      <div class="container clearfix">
    <ul class="list-social pull-right">
          <li><a class="icon-1" href="#"></a></li>
          <li><a class="icon-2" href="#"></a></li>
          <li><a class="icon-3" href="#"></a></li>
          <li><a class="icon-4" href="#"></a></li>
        </ul>
    <div class="privacy pull-left">&copy; 2013 | <a href="http://www.dzyngiri.com">Dzyngiri : Online Design Magazine</a> |</div>
  </div>
    </footer>
	<script type="text/javascript" src="js/bootstrap.js"></script>
</body>
</html>